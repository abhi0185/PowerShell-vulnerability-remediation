# Problem : Insecure Microsoft Internet Explorer  Restricted Zone User Setting Detected 
# Jira Tracking ID : VRG-121
# Author : Abhishek Yadav
# Reviewer : B.Ugesh, Akash Agrawal
# Unit Test : Akshay Raut
# Date of Fix : 08/10/2017
# Objective : The script sets the user settings for restricted zones to secure levels.
# PowerShell script for Window OS
# preconditions : Admin access needed, Please ensure BackUp before executing the code

# {


$ErrorActionPreference="SilentlyContinue"
Stop-Transcript | out-null
$ErrorActionPreference = "Continue"
#Start-Transcript -path C:\users\605961\desktop\output.txt -append
$parentPath = split-path -parent $MyInvocation.MyCommand.Path
New-Item -path $parentPath\VRG121_Log -ItemType directory -force
Start-Transcript -path $parentPath\VRG121_Log\VRG121_VulnerabilityFix.log –append 

 
"Setting the security levels for Restricted sites zone..." | write-host 


$registryPath = "HKLM:\SOFTWARE\MICROSOFT\WINDOWS\CURRENTVERSION\INTERNET SETTINGS\ZONES\4"

#Download Signed ActiveX Controls' to Prompt (minimum)   
New-ItemProperty -Path $registryPath -Name "1001" -Value "1" -PropertyType DWORD -Force 

# Download unsigned ActiveX controls - Disable     
New-ItemProperty -Path $registryPath -Name "1004" -Value "3" -PropertyType DWORD -Force 

# Initialize and script ActiveX controls not marked as safe - Disable     
New-ItemProperty -Path $registryPath -Name "1201" -Value "3" -PropertyType DWORD -Force

# Allow scripting of Internet Explorer Webbrowser control - Disable     
New-ItemProperty -Path $registryPath -Name "1206" -Value "3" -PropertyType DWORD -Force

# Access data sources across domains - Disable     
New-ItemProperty -Path $registryPath -Name "1406" -Value "3" -PropertyType DWORD -Force 

# Display mixed content - Prompt (minimum)     
New-ItemProperty -Path $registryPath -Name "1609" -Value "1" -PropertyType DWORD -Force 

# Downloads: Font download - Disable     
New-ItemProperty -Path $registryPath -Name "1604" -Value "3" -PropertyType DWORD -Force 

# Installation of desktop items - Prompt (minimum)     
New-ItemProperty -Path $registryPath -Name "1800" -Value "1" -PropertyType DWORD -Force 

# Launching programs and files in an IFRAME - Prompt (minimum)     
New-ItemProperty -Path $registryPath -Name "1804" -Value "1" -PropertyType DWORD -Force 

# Allow script initiated windows without size or position constraints - Disable     
New-ItemProperty -Path $registryPath -Name "2102" -Value "3" -PropertyType DWORD -Force 

# Allow web pages to use restricted protocols for active content - Prompt (minimum)     
New-ItemProperty -Path $registryPath -Name "2300" -Value "1" -PropertyType DWORD -Force 

# Open files based on content, not file extension - Disable     
New-ItemProperty -Path $registryPath -Name "2100" -Value "3" -PropertyType DWORD -Force 

# Submit non-encrypted form data - Prompt (minimum)     
New-ItemProperty -Path $registryPath -Name "1601" -Value "1" -PropertyType DWORD -Force 

# Use Pop-up Blocker - Enable     
New-ItemProperty -Path $registryPath -Name "1809" -Value "0" -PropertyType DWORD -Force 

#Run ActiveX controls and plug-ins -Disable
New-ItemProperty -Path $registryPath -Name "1200" -Value "3" -PropertyType DWORD -Force 

#Script ActiveX controls marked as safe for scripting - Disable
New-ItemProperty -Path $registryPath -Name "1405" -Value "3" -PropertyType DWORD -Force 

#Active scripting - Disable
New-ItemProperty -Path $registryPath -Name "1400" -Value "3" -PropertyType DWORD -Force 

#User Authentication: Logon - Prompt
New-ItemProperty -Path $registryPath -Name "1A00" -Value "65536" -PropertyType DWORD -Force 

#Scripting of Java applets - Disable
New-ItemProperty -Path $registryPath -Name "1402" -Value "3" -PropertyType DWORD -Force 

#Allow META REFRESH - Disable
New-ItemProperty -Path $registryPath -Name "1608" -Value "3" -PropertyType DWORD -Force 

#Userdata persistence - Disable
New-ItemProperty -Path $registryPath -Name "1606" -Value "3" -PropertyType DWORD -Force 

#Submit non-encrypted form data - Prompt
New-ItemProperty -Path $registryPath -Name "1601" -Value "1" -PropertyType DWORD -Force 

#Navigate sub-frames across different domains - Prompt
New-ItemProperty -Path $registryPath -Name "1607" -Value "1" -PropertyType DWORD -Force 

#Drag and drop or copy and paste files - Prompt
New-ItemProperty -Path $registryPath -Name "1802" -Value "1" -PropertyType DWORD -Force 

#Don't prompt for client certificate selection when no certificates or only one certificate exists - Disable
New-ItemProperty -Path $registryPath -Name "1A04" -Value "3" -PropertyType DWORD -Force 

#Java permissions - Disable
New-ItemProperty -Path $registryPath -Name "1C00" -Value "3" -PropertyType DWORD -Force 


write-host "Security levels are set"

Stop-Transcript



# }
