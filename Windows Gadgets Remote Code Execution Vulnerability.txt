# Problem : Microsoft Windows Gadgets Remote Code Execution Vulnerability (KB2719662)
# Jira Tracking ID : VRG-121
# Author : Sai Jeevan
# Reviewer : B.Ugesh, Akash Agrawal
# Unit Test : Abhishek Yadav
# Date of Fix : 08/10/2017
# PowerShell script for Window OS
# Objective : The script removes the Vulnerability from Windows Gadgets

# preconditions : Admin access needed, Please ensure BackUp before executing the code

# {

$ErrorActionPreference="SilentlyContinue"
Stop-Transcript | out-null
$ErrorActionPreference = "Continue"
$parentPath = split-path -parent $MyInvocation.MyCommand.Path
New-Item -path $parentPath\Log -ItemType directory -force
Start-Transcript -path $parentPath\Log\VRG61_VulnerabilityFix.log –append



if (!(test-path HKLM:\SOFTWARE\MICROSOFT\WINDOWS\CURRENTVERSION\POLICIES\WINDOWS))
{	
$registryPath = "HKLM:\SOFTWARE\MICROSOFT\WINDOWS\CURRENTVERSION\POLICIES"
$Key = "Windows"
New-Item -Path $registryPath -name $Key 
}


if (!(test-path HKLM:\SOFTWARE\MICROSOFT\WINDOWS\CURRENTVERSION\POLICIES\WINDOWS\sidebar))
{	
$registryPath1 = "HKLM:\SOFTWARE\MICROSOFT\WINDOWS\CURRENTVERSION\POLICIES\WINDOWS"
$Key1 = "Sidebar"
New-Item -Path $registryPath1 -name $Key1 
}


$registryPath2 = "HKLM:\SOFTWARE\MICROSOFT\WINDOWS\CURRENTVERSION\POLICIES\WINDOWS\Sidebar"
$name = "TurnOffSidebar"
$value="1"


New-ItemProperty -Path $registryPath2 -Name $name -Value $value -PropertyType DWORD -Force


Stop-Transcript

# }